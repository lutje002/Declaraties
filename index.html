<!DOCTYPE html>
<html lang="nl">
<head>
    <title>NCubed Declaraties</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="NCubed Declaraties">
    <meta name="theme-color" content="#2196F3">
    
    <!-- Required libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://unpkg.com/tesseract.js@5.0.5/dist/tesseract.min.js"></script>

    <style>
        :root {
            --blue-color: #2196F3;
            --blue-dark: #1976D2;
            --blue-light: #BBDEFB;
            --pink-color: #E91E63;
            --danger-color: #f44336;
            --success-color: #4CAF50;
            --background-color: #f5f5f5;
            --border-color: #ddd;
            --text-color: #333;
            --safe-area-inset-top: env(safe-area-inset-top);
            --safe-area-inset-bottom: env(safe-area-inset-bottom);
        }

        /* Styles omitted for brevity */
    </style>
</head>
<body>
    <div class="container">
        <h1>NCubed Declaraties</h1>
        
        <div class="upload-container" id="dropZone">
            <input type="file" id="photoInput" accept="image/*" multiple style="display: none;">
            <button class="button button-blue" onclick="document.getElementById('photoInput').click()">
                Upload Bonnetjes
            </button>
            <p>Of sleep bonnetjes hierheen</p>
        </div>

        <label for="clientProject">Klant/Project:</label>
        <input type="text" id="clientProject" placeholder="Vul klant of project in" style="width: 100%; padding: 8px; margin-bottom: 15px; border: 1px solid var(--border-color); border-radius: 8px;">

        <div id="previewContainer" class="preview-container"></div>

        <div id="declarationContainer">
            <table id="declarationTable">
                <thead>
                    <tr>
                        <th>Bon #</th>
                        <th>Datum</th>
                        <th>Naam</th>
                        <th>Categorie</th>
                        <th>Bedrag</th>
                        <th>Actie</th>
                    </tr>
                </thead>
                <tbody id="declarationBody"></tbody>
                <tfoot>
                    <tr>
                        <td colspan="4"><strong>Totaal</strong></td>
                        <td id="declarationTotal">€0,00</td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>

            <div class="button-container">
                <button class="button button-danger" onclick="clearAll()">Wis Alles</button>
                <button class="button button-blue" onclick="generatePDF()">Download PDF</button>
                <button class="button button-success" onclick="sendEmailOnly()">Verstuur Mail</button>
            </div>
        </div>
    </div>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <div id="notification" class="notification"></div>

    <script>
        // JavaScript code omitted for brevity

        function sendEmailOnly() {
            const rows = document.querySelectorAll('#declarationBody tr');
            const categories = {};
            let totalAmount = 0;
            const clientProject = document.getElementById('clientProject').value; // Get Klant/Project input
            
            rows.forEach(row => {
                const category = row.cells[3].querySelector('select').value;
                const amount = parseFloat(row.cells[4].textContent.replace('€', '').replace(',', '.'));
                if (!categories[category]) categories[category] = 0;
                if (!isNaN(amount)) {
                    categories[category] += amount;
                    totalAmount += amount;
                }
            });

            let emailBody = `Hierbij mijn declaratie voor ${clientProject}.\n\nSpecificatie:\n\n`; // Include Klant/Project in email body
            
            Object.entries(categories)
                .sort(([a], [b]) => a.localeCompare(b))
                .forEach(([category, amount]) => {
                    emailBody += `${category}: €${amount.toFixed(2)}\n`;
                });
            
            emailBody += `\nTotaalbedrag: €${totalAmount.toFixed(2)}\n\n`;
            const mailtoLink = `mailto:invoices@ncubed.nl?cc=rene.lutjenkossink@ncubed.nl&subject=Declaratie ${new Date().toLocaleDateString('nl-NL')}&body=${encodeURIComponent(emailBody)}`;
            
            window.location.href = mailtoLink;
            showNotification('Email wordt voorbereid');
        }

        // Initialize
        initializeWorker().catch(error => {
            console.error('Error initializing Tesseract worker:', error);
            showNotification('Fout bij initialiseren van tekstherkenning', 'error');
        });
    </script>
</body>
</html>

